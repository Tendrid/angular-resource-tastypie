/*
 Angular Resource Tastypie v1.0.0
 (c) 2014 Marcos W. Ferretti, http://br.linkedin.com/in/mwferretti/
 License: MIT
*/
function TastypieProvider(g){g.defaults.useXDomain=!0;delete g.defaults.headers.common["X-Requested-With"];g.defaults.headers.common["Content-Type"]="application/json";var h="",e="",f="",k="";this.setResourceUrl=function(a){h=a;a=document.createElement("a");a.href=h;e=a.protocol+"//"+a.hostname;""!=a.port&&(e=e+":"+a.port)};this.setAuth=function(a,c){f=a;k=c;g.defaults.headers.common.Authorization="ApiKey "+f+":"+k};this.getResourceUrl=function(){return h};this.getResourceDomain=function(){return e};
this.$get=function(){return{resource_url:this.getResourceUrl(),resource_domain:this.getResourceDomain()}}}
function TastypiePaginatorFactory(g,h){function e(a,b,d){this.resource=a;this.filters=b||{};this.meta={};this.objects=[];this.len=this.index=0;this.range=[];f(this,d)}function f(a,b){if(!angular.isObject(b.meta))throw"Invalid django-tastypie obj";a.meta=b.meta;angular.forEach(b.objects,function(d,l){b.objects[l]=a.resource.objects.$create(d)});a.objects=b.objects;a.len=Math.ceil(b.meta.total_count/b.meta.limit);a.index=0==b.meta.offset?1:Math.ceil(b.meta.offset/b.meta.limit)+1;for(var d=[],l=1;l<=
a.len;l++)d.push(l);a.range=d}function k(a,b){b&&g(b).get().$promise.then(function(d){f(a,d)},function(a){throw a;})}function a(c,b,d){(b!=c.index||d)&&0<b&&b<=c.len&&(d=angular.copy(c.filters),d.offset=(b-1)*c.meta.limit,g(c.resource.endpoint,c.resource.defaults).get(d).$promise.then(function(d){d.meta.offset==d.meta.total_count?a(c,b-1,!0):f(c,d)},function(a){throw a;}))}e.prototype.change=function(c){c&&a(this,c,!1)};e.prototype.next=function(){this.meta.next&&k(this,h.resource_domain+this.meta.next)};
e.prototype.previous=function(){this.meta.previous&&k(this,h.resource_domain+this.meta.previous)};e.prototype.refresh=function(){a(this,this.index,!0)};e.prototype.first=function(){a(this,1,!1)};e.prototype.last=function(){a(this,this.len,!1)};return e}
function TastypieObjectsFactory(g,h){function e(a){this.resource=a}function f(a,c){var b=g(a.resource.endpoint,{id:"@id"},{post:{method:"POST"},save:{method:"POST"},get:{method:"GET",url:a.resource.endpoint+":id%2f"},get_uri:{method:"GET",url:a.resource.endpoint+":id%2f"},update:{method:"PUT",url:a.resource.endpoint+":id%2f"},"delete":{method:"DELETE",url:a.resource.endpoint+":id%2f"},remove:{method:"DELETE",url:a.resource.endpoint+":id%2f"}});delete b.prototype.$query;b.prototype.$get=function(a){a=
a||this;if(!a.hasOwnProperty("id"))throw"attribute [id] is required.";return this.$get_uri(a)};b.prototype.$update=function(d){d=d||this;if(!d.hasOwnProperty("id"))throw"attribute [id] is required.";var b=null,b=this.$put(d);b.then(function(d){typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()});return b};b.prototype.$delete=function(a){a=a||this;if(!a.hasOwnProperty("id"))throw"attribute [id] is required.";return this.$remove(a)};b.prototype.$save=function(){var b=null,b=
this.hasOwnProperty("id")?this.$update():this.$post();b.then(function(b){typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()});return b};b.prototype.$delete=function(){var b=this;return this.$remove().then(function(){angular.forEach(b,function(a,c){delete b[c]});typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()})};b.prototype.$clear=function(){var a=this;angular.forEach(a,function(b,c){delete a[c]})};return new b(c)}function k(a){var c=g(a.resource.endpoint,
a.resource.defaults,{get:{method:"GET"},find:{method:"GET"}});delete c.prototype.$query;delete c.prototype.$save;c.prototype.$find=function(b){var d=this.$get(b),c=this;d.then(function(d){a.resource.page=new h(a.resource,b,d);c.page=a.resource.page;delete c.meta;delete c.objects},function(b){a.resource.page={};c.page={}});return d};return new c}e.prototype.$create=function(a){return f(this,a)};e.prototype.$get=function(a){return f(this,a).$get()};e.prototype.$delete=function(a){return f(this,a).$delete()};
e.prototype.$find=function(a){return k(this).$find(a)};return e}function TastypieResourceFactory(g,h,e,f){return function(e,a){if(!e)throw"unknown service name";this.endpoint=h.resource_url+e+"%2f";this.defaults=a||{};this.page={};this.objects=new f(this)}}var ResourceTastypieModule=angular.module("ngResourceTastypie",["ngResource"]);TastypieProvider.$inject=["$httpProvider"];ResourceTastypieModule.provider("$tastypie",TastypieProvider);TastypiePaginatorFactory.$inject=["$resource","$tastypie"];
ResourceTastypieModule.factory("$tastypiePaginator",TastypiePaginatorFactory);TastypieObjectsFactory.$inject=["$resource","$tastypiePaginator"];ResourceTastypieModule.factory("$tastypieObjects",TastypieObjectsFactory);TastypieResourceFactory.$inject=["$resource","$tastypie","$tastypiePaginator","$tastypieObjects"];ResourceTastypieModule.factory("$tastypieResource",TastypieResourceFactory);
