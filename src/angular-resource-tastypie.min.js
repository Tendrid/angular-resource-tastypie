/*
 AngularJs Resource Tastypie v1.0.0
 (c) 2014 Marcos W. Ferretti, http://br.linkedin.com/in/mwferretti/
 License: MIT
*/
function TastypieProvider(e){e.defaults.useXDomain=!0;delete e.defaults.headers.common["X-Requested-With"];e.defaults.headers.common["Content-Type"]="application/json";var g="",c="",h="",b="";this.setResourceUrl=function(a){g=a;a=document.createElement("a");a.href=g;c=a.protocol+"//"+a.hostname;""!=a.port&&(c=c+":"+a.port)};this.setAuth=function(a,f){h=a;b=f;e.defaults.headers.common.Authorization="ApiKey "+h+":"+b};this.getResourceUrl=function(){return g};this.getResourceDomain=function(){return c};
this.$get=function(){return{resource_url:this.getResourceUrl(),resource_domain:this.getResourceDomain()}}}
function TastypiePaginatorFactory(e,g){function c(f,a,b){this.resource=f;this.filters=a||{};this.meta={};this.objects=[];this.len=this.index=0;this.range=[];h(this,b)}function h(f,a){if(!angular.isObject(a.meta))throw"Invalid django-tastypie obj";f.meta=a.meta;angular.forEach(a.objects,function(b,c){a.objects[c]=f.resource.objects.$create(b)});f.objects=a.objects;f.len=Math.ceil(a.meta.total_count/a.meta.limit);f.index=0==a.meta.offset?1:Math.ceil(a.meta.offset/a.meta.limit)+1;for(var b=[],c=1;c<=
f.len;c++)b.push(c);f.range=b}function b(a,b){b&&e(b).get().$promise.then(function(b){h(a,b)},function(a){throw a;})}function a(b,c,d){(c!=b.index||d)&&0<c&&c<=b.len&&(d=angular.copy(b.filters),d.offset=(c-1)*b.meta.limit,e(b.resource.endpoint,b.resource.defaults).get(d).$promise.then(function(d){d.meta.offset==d.meta.total_count?a(b,c-1,!0):h(b,d)},function(a){throw a;}))}c.prototype.change=function(b){b&&a(this,b,!1)};c.prototype.next=function(){this.meta.next&&b(this,g.resource_domain+this.meta.next)};
c.prototype.previous=function(){this.meta.previous&&b(this,g.resource_domain+this.meta.previous)};c.prototype.refresh=function(){a(this,this.index,!0)};c.prototype.first=function(){a(this,1,!1)};c.prototype.last=function(){a(this,this.len,!1)};return c}
function TastypieObjectsFactory(e,g){function c(c){this.resource=c}c.prototype.$create=function(c){var b=this,a=e(b.resource.endpoint,{id:"@id"},{save:{method:"POST"},update:{method:"PUT",url:b.resource.endpoint+":id%2f"},"delete":{method:"DELETE",url:b.resource.endpoint+":id%2f"},rm:{method:"DELETE",url:b.resource.endpoint+":id%2f"},sv:{method:"POST"}});delete a.prototype.$get;delete a.prototype.$query;delete a.prototype.$remove;a.prototype.$save=function(){var a=this.$sv();a.then(function(a){typeof b.resource.page.refresh==
typeof Function&&b.resource.page.refresh()});return a};a.prototype.$delete=function(){var a=this;return this.$rm().then(function(){angular.forEach(a,function(b,c){delete a[c]});typeof b.resource.page.refresh==typeof Function&&b.resource.page.refresh()})};a.prototype.$clear=function(){var a=this;angular.forEach(a,function(b,c){delete a[c]})};return new a(c)};c.prototype.$find=function(c){var b=this,a=e(b.resource.endpoint,b.resource.defaults,{find:{method:"GET"},get:{method:"GET"}});delete a.prototype.$query;
delete a.prototype.$save;a.prototype.$find=function(a){var c=this.$get(a),d=this;c.then(function(c){b.resource.page=new g(b.resource,a,c);d.page=b.resource.page;delete d.meta;delete d.objects},function(a){b.resource.page={};d.page={}});return c};return(new a).$find(c)};return c}function TastypieResourceFactory(e,g,c,h){return function(b,a){if(!b)throw"unknown service name";this.endpoint=g.resource_url+b+"%2f";this.defaults=a||{};this.page={};this.objects=new h(this)}}
var ResourceTastypieModule=angular.module("ngResourceTastypie",["ngResource"]);TastypieProvider.$inject=["$httpProvider"];ResourceTastypieModule.provider("$tastypie",TastypieProvider);TastypiePaginatorFactory.$inject=["$resource","$tastypie"];ResourceTastypieModule.factory("$tastypiePaginator",TastypiePaginatorFactory);TastypieObjectsFactory.$inject=["$resource","$tastypiePaginator"];ResourceTastypieModule.factory("$tastypieObjects",TastypieObjectsFactory);
TastypieResourceFactory.$inject=["$resource","$tastypie","$tastypiePaginator","$tastypieObjects"];ResourceTastypieModule.factory("$tastypieResource",TastypieResourceFactory);
