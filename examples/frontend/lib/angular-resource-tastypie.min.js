/*
 Angular Resource Tastypie v1.0.0
 (c) 2014 Marcos W. Ferretti, http://br.linkedin.com/in/mwferretti/
 License: MIT
*/
function TastypieProvider(f){f.defaults.useXDomain=!0;delete f.defaults.headers.common["X-Requested-With"];f.defaults.headers.common["Content-Type"]="application/json";var g="",b="",e="",h="";this.setResourceUrl=function(a){g=a;a=document.createElement("a");a.href=g;b=a.protocol+"//"+a.hostname;""!=a.port&&(b=b+":"+a.port)};this.setAuth=function(a,k){e=a;h=k;f.defaults.headers.common.Authorization="ApiKey "+e+":"+h};this.getResourceUrl=function(){return g};this.getResourceDomain=function(){return b};
this.$get=function(){return{resource_url:this.getResourceUrl(),resource_domain:this.getResourceDomain()}}}
function TastypiePaginatorFactory(f,g){function b(a,c,d){this.resource=a;this.filters=c||{};this.meta={};this.objects=[];this.len=this.index=0;this.range=[];e(this,d)}function e(a,c){if(!angular.isObject(c.meta))throw"Invalid django-tastypie obj";a.meta=c.meta;angular.forEach(c.objects,function(d,b){c.objects[b]=a.resource.objects.$create(d)});a.objects=c.objects;a.len=Math.ceil(c.meta.total_count/c.meta.limit);a.index=0==c.meta.offset?1:Math.ceil(c.meta.offset/c.meta.limit)+1;for(var d=[],b=1;b<=
a.len;b++)d.push(b);a.range=d}function h(a,c){c&&f(c).get().$promise.then(function(d){e(a,d)},function(a){throw a;})}function a(b,c,d){(c!=b.index||d)&&0<c&&c<=b.len&&(d=angular.copy(b.filters),d.offset=(c-1)*b.meta.limit,f(b.resource.endpoint,b.resource.defaults).get(d).$promise.then(function(d){d.meta.offset==d.meta.total_count?a(b,c-1,!0):e(b,d)},function(a){throw a;}))}b.prototype.change=function(b){b&&a(this,b,!1)};b.prototype.next=function(){this.meta.next&&h(this,g.resource_domain+this.meta.next)};
b.prototype.previous=function(){this.meta.previous&&h(this,g.resource_domain+this.meta.previous)};b.prototype.refresh=function(){a(this,this.index,!0)};b.prototype.first=function(){a(this,1,!1)};b.prototype.last=function(){a(this,this.len,!1)};return b}
function TastypieObjectsFactory(f,g){function b(a){this.resource=a}function e(a,b){var c=f(a.resource.endpoint,{id:"@id"},{post:{method:"POST"},save:{method:"POST"},get:{method:"GET",url:a.resource.endpoint+":id%2f"},get_uri:{method:"GET",url:a.resource.endpoint+":id%2f"},update:{method:"PUT",url:a.resource.endpoint+":id%2f"},"delete":{method:"DELETE",url:a.resource.endpoint+":id%2f"},remove:{method:"DELETE",url:a.resource.endpoint+":id%2f"}});delete c.prototype.$query;c.prototype.$get=function(a){a=
a||this;if(!a.hasOwnProperty("id"))throw"attribute [id] is required.";return this.$get_uri(a)};c.prototype.$delete=function(a){a=a||this;if(!a.hasOwnProperty("id"))throw"attribute [id] is required.";return this.$remove(a)};c.prototype.$save=function(){var b=null,b=this.hasOwnProperty("id")?this.$update():this.$post();b.then(function(b){typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()});return b};c.prototype.$delete=function(){var b=this;return this.$remove().then(function(){angular.forEach(b,
function(a,c){delete b[c]});typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()})};c.prototype.$clear=function(){var a=this;angular.forEach(a,function(b,c){delete a[c]})};return new c(b)}function h(a){var b=f(a.resource.endpoint,a.resource.defaults,{get:{method:"GET"},find:{method:"GET"}});delete b.prototype.$query;delete b.prototype.$save;b.prototype.$find=function(b){var d=this.$get(b),e=this;d.then(function(d){a.resource.page=new g(a.resource,b,d);e.page=a.resource.page;
delete e.meta;delete e.objects},function(b){a.resource.page={};e.page={}});return d};return new b}b.prototype.$create=function(a){return e(this,a)};b.prototype.$get=function(a){return e(this,a).$get()};b.prototype.$delete=function(a){return e(this,a).$delete()};b.prototype.$find=function(a){return h(this).$find(a)};return b}
function TastypieResourceFactory(f,g,b,e){return function(b,a){if(!b)throw"unknown service name";this.endpoint=g.resource_url+b+"%2f";this.defaults=a||{};this.page={};this.objects=new e(this)}}var ResourceTastypieModule=angular.module("ngResourceTastypie",["ngResource"]);TastypieProvider.$inject=["$httpProvider"];ResourceTastypieModule.provider("$tastypie",TastypieProvider);TastypiePaginatorFactory.$inject=["$resource","$tastypie"];ResourceTastypieModule.factory("$tastypiePaginator",TastypiePaginatorFactory);
TastypieObjectsFactory.$inject=["$resource","$tastypiePaginator"];ResourceTastypieModule.factory("$tastypieObjects",TastypieObjectsFactory);TastypieResourceFactory.$inject=["$resource","$tastypie","$tastypiePaginator","$tastypieObjects"];ResourceTastypieModule.factory("$tastypieResource",TastypieResourceFactory);
