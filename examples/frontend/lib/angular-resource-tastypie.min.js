/*
 Angular Resource Tastypie v1.0.0
 (c) 2014 Marcos W. Ferretti, http://br.linkedin.com/in/mwferretti/
 License: MIT
*/
function TastypieProvider(g){g.defaults.useXDomain=!0;delete g.defaults.headers.common["X-Requested-With"];g.defaults.headers.common["Content-Type"]="application/json";var h="",d="",f="",k="";this.setResourceUrl=function(a){h=a;a=document.createElement("a");a.href=h;d=a.protocol+"//"+a.hostname;""!=a.port&&(d=d+":"+a.port)};this.setAuth=function(a,c){f=a;k=c;g.defaults.headers.common.Authorization="ApiKey "+f+":"+k};this.getResourceUrl=function(){return h};this.getResourceDomain=function(){return d};
this.$get=function(){return{resource_url:this.getResourceUrl(),resource_domain:this.getResourceDomain()}}}
function TastypiePaginatorFactory(g,h){function d(a,b,e){this.resource=a;this.filters=b||{};this.meta={};this.objects=[];this.len=this.index=0;this.range=[];f(this,e)}function f(a,b){if(!angular.isObject(b.meta))throw"Invalid django-tastypie obj";a.meta=b.meta;angular.forEach(b.objects,function(e,l){b.objects[l]=a.resource.objects.$create(e)});a.objects=b.objects;a.len=Math.ceil(b.meta.total_count/b.meta.limit);a.index=0==b.meta.offset?1:Math.ceil(b.meta.offset/b.meta.limit)+1;for(var e=[],l=1;l<=
a.len;l++)e.push(l);a.range=e}function k(a,b){b&&g(b).get().$promise.then(function(e){f(a,e)},function(a){throw a;})}function a(c,b,e){(b!=c.index||e)&&0<b&&b<=c.len&&(e=angular.copy(c.filters),e.offset=(b-1)*c.meta.limit,g(c.resource.endpoint,c.resource.defaults).get(e).$promise.then(function(e){e.meta.offset==e.meta.total_count?a(c,b-1,!0):f(c,e)},function(a){throw a;}))}d.prototype.change=function(c){c&&a(this,c,!1)};d.prototype.next=function(){this.meta.next&&k(this,h.resource_domain+this.meta.next)};
d.prototype.previous=function(){this.meta.previous&&k(this,h.resource_domain+this.meta.previous)};d.prototype.refresh=function(){a(this,this.index,!0)};d.prototype.first=function(){a(this,1,!1)};d.prototype.last=function(){a(this,this.len,!1)};return d}
function TastypieObjectsFactory(g,h){function d(a){this.resource=a}function f(a,c){var b=g(a.resource.endpoint,{id:"@id"},{post:{method:"POST"},save:{method:"POST"},get:{method:"GET",url:a.resource.endpoint+":id%2f"},get_uri:{method:"GET",url:a.resource.endpoint+":id%2f"},update:{method:"PUT",url:a.resource.endpoint+":id%2f"},"delete":{method:"DELETE",url:a.resource.endpoint+":id%2f"},remove:{method:"DELETE",url:a.resource.endpoint+":id%2f"}});delete b.prototype.$query;b.prototype.$get=function(a){a=
a||this;if(!a.hasOwnProperty("id"))throw"attribute [id] is required.";return this.$get_uri(a)};b.prototype.$update=function(e){e=e||this;if(!e.hasOwnProperty("id"))throw"attribute [id] is required.";var b=null,b=this.$put(e);b.then(function(b){typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()});return b};b.prototype.$save=function(){var b=null,b=this.hasOwnProperty("id")?this.$update():this.$post();b.then(function(b){typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()});
return b};b.prototype.$delete=function(b){var c=b||this,d=this;if(!c.hasOwnProperty("id"))throw"attribute [id] is required.";return this.$remove().then(function(){angular.forEach(d,function(a,b){delete c[b]});typeof a.resource.page.refresh==typeof Function&&a.resource.page.refresh()})};b.prototype.$clear=function(){var a=this;angular.forEach(a,function(b,c){delete a[c]})};return new b(c)}function k(a){var c=g(a.resource.endpoint,a.resource.defaults,{get:{method:"GET"},find:{method:"GET"}});delete c.prototype.$query;
delete c.prototype.$save;c.prototype.$find=function(b){var c=this.$get(b),d=this;c.then(function(c){a.resource.page=new h(a.resource,b,c);d.page=a.resource.page;delete d.meta;delete d.objects},function(b){a.resource.page={};d.page={}});return c};return new c}d.prototype.$create=function(a){return f(this,a)};d.prototype.$get=function(a){return f(this,a).$get()};d.prototype.$delete=function(a){return f(this,a).$delete()};d.prototype.$find=function(a){return k(this).$find(a)};return d}
function TastypieResourceFactory(g,h,d,f){return function(d,a){if(!d)throw"unknown service name";this.endpoint=h.resource_url+d+"%2f";this.defaults=a||{};this.page={};this.objects=new f(this)}}var ResourceTastypieModule=angular.module("ngResourceTastypie",["ngResource"]);TastypieProvider.$inject=["$httpProvider"];ResourceTastypieModule.provider("$tastypie",TastypieProvider);TastypiePaginatorFactory.$inject=["$resource","$tastypie"];ResourceTastypieModule.factory("$tastypiePaginator",TastypiePaginatorFactory);
TastypieObjectsFactory.$inject=["$resource","$tastypiePaginator"];ResourceTastypieModule.factory("$tastypieObjects",TastypieObjectsFactory);TastypieResourceFactory.$inject=["$resource","$tastypie","$tastypiePaginator","$tastypieObjects"];ResourceTastypieModule.factory("$tastypieResource",TastypieResourceFactory);
