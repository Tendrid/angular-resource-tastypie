/*
 AngularJs Resource Tastypie v1.0.0
 (c) 2014 Marcos W. Ferretti LTDA ME, linkedin http://www.linkedin.com/pub/marcos-w-ferretti/32/928/a53
 License: MIT
*/
function TastypieProvider(e){e.defaults.useXDomain=!0;delete e.defaults.headers.common["X-Requested-With"];e.defaults.headers.common["Content-Type"]="application/json";var f="",b="",g="",c="";this.setResourceUrl=function(a){f=a;a=document.createElement("a");a.href=f;b=a.protocol+"//"+a.hostname;""!=a.port&&(b=b+":"+a.port)};this.setAuth=function(a,d){g=a;c=d;e.defaults.headers.common.Authorization="ApiKey "+g+":"+c};this.getResourceUrl=function(){return f};this.getResourceDomain=function(){return b};
this.$get=function(){return{resource_url:this.getResourceUrl(),resource_domain:this.getResourceDomain()}}}
function TastypiePaginatorFactory(e,f){function b(d,a,c){this.resource=d;this.filters=a||{};this.meta={};this.objects=[];this.len=this.index=0;this.range=[];g(this,c)}function g(d,a){if(!angular.isObject(a.meta))throw"Invalid django-tastypie obj";d.meta=a.meta;angular.forEach(a.objects,function(c,b){a.objects[b]=d.resource.objects.$create(c)});d.objects=a.objects;d.len=Math.ceil(a.meta.total_count/a.meta.limit);d.index=0==a.meta.offset?1:Math.ceil(a.meta.offset/a.meta.limit)+1;for(var c=[],b=1;b<=
d.len;b++)c.push(b);d.range=c}function c(a,c){c&&e(c).get().$promise.then(function(c){g(a,c)},function(a){throw a;})}function a(d,c,b){(c!=d.index||b)&&0<c&&c<=d.len&&(b=angular.copy(d.filters),b.offset=(c-1)*d.meta.limit,e(d.resource.endpoint,d.resource.defaults).get(b).$promise.then(function(b){b.meta.offset==b.meta.total_count?a(d,c-1,!0):g(d,b)},function(a){throw a;}))}b.prototype.change=function(c){c&&a(this,c,!1)};b.prototype.next=function(){this.meta.next&&c(this,f.resource_domain+this.meta.next)};
b.prototype.previous=function(){this.meta.previous&&c(this,f.resource_domain+this.meta.previous)};b.prototype.refresh=function(){a(this,this.index,!0)};b.prototype.first=function(){a(this,1,!1)};b.prototype.last=function(){a(this,this.len,!1)};return b}
function TastypieObjectsFactory(e,f){function b(b){this.resource=b}b.prototype.$create=function(b){var c=this,a=e(c.resource.endpoint,{id:"@id"},{save:{method:"POST"},update:{method:"PUT",url:c.resource.endpoint+":id%2f"},"delete":{method:"DELETE",url:c.resource.endpoint+":id%2f"},rm:{method:"DELETE",url:c.resource.endpoint+":id%2f"},sv:{method:"POST"}});delete a.prototype.$get;delete a.prototype.$query;delete a.prototype.$remove;a.prototype.$save=function(){var a=this.$sv();a.then(function(a){c.resource.page.refresh()});
return a};a.prototype.$delete=function(){var a=this;return this.$rm().then(function(){angular.forEach(a,function(c,b){delete a[b]});c.resource.page.refresh()})};a.prototype.$clear=function(){var a=this;angular.forEach(a,function(c,b){delete a[b]})};return new a(b)};b.prototype.$find=function(b){var c=this,a=e(c.resource.endpoint,c.resource.defaults,{find:{method:"GET"},get:{method:"GET"}});delete a.prototype.$query;delete a.prototype.$save;a.prototype.$find=function(a){var b=this.$get(a),e=this;b.then(function(b){c.resource.page=
new f(c.resource,a,b);e.page=c.resource.page;delete e.meta;delete e.objects},function(a){c.resource.page={};e.page={}});return b};return(new a).$find(b)};return b}function TastypieResourceFactory(e,f,b,g){return function(b,a){if(!b)throw"unknown service name";this.endpoint=f.resource_url+b+"%2f";this.defaults=a||{};this.page={};this.objects=new g(this)}}var ResourceTastypieModule=angular.module("ngResourceTastypie",["ngResource"]);TastypieProvider.$inject=["$httpProvider"];
ResourceTastypieModule.provider("$tastypie",TastypieProvider);TastypiePaginatorFactory.$inject=["$resource","$tastypie"];ResourceTastypieModule.factory("$tastypiePaginator",TastypiePaginatorFactory);TastypieObjectsFactory.$inject=["$resource","$tastypiePaginator"];ResourceTastypieModule.factory("$tastypieObjects",TastypieObjectsFactory);TastypieResourceFactory.$inject=["$resource","$tastypie","$tastypiePaginator","$tastypieObjects"];ResourceTastypieModule.factory("$tastypieResource",TastypieResourceFactory);
